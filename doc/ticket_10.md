### 压测

此处使用apache-jmeter-5.6.3压测，仅为快速地大致观察性能变化，非极限机器性能下的最佳压测环境的压测结果，数据仅供参考。

（更标准的压测方式：[使用jmeter做压力测试-CSDN博客](https://blog.csdn.net/2301_79902294/article/details/152604582?spm=1001.2014.3001.5501)）

#### 1，v1未优化

| Label | #样本  | 平均值 | 中位数 | 90%百分位 | 95%百分位 | 99%百分位 | 最小值 | 最大值 | 异常% | 吞吐量     | 接收 KB/sec | 发送 KB/sec |
| ----- | ------ | ------ | ------ | --------- | --------- | --------- | ------ | ------ | ----- | ---------- | ----------- | ----------- |
| 购票  | 14352  | 803    | 781    | 957       | 1,040     | 1,088     | 173    | 1,303  | 0.00% | 1143.4/sec | 311.53      | 877.65      |
| 查票  | 66,063 | 958    | 927    | 1,079     | 1,136     | 1,185     | 177    | 1,519  | 0.00% | 1025.6/sec | 668.08      | 489.74      |

![image-20250930210528777](..\resource\Images\压测1.png)

![image-20250930205303223](..\resource\Images\压测2.png)

#### 2，v1优化后

仅添加redis和MQ：

(事实证明，消息队列本身不能直接提高单个接口的吞吐量，而缓存对于查询接口的提升是巨大的。)

| Label | #样本  | 平均值 | 中位数 | 90%百分位 | 95%百分位 | 99%百分位 | 最小值 | 最大值 | 异常% | 吞吐量     | 接收 KB/sec | 发送 KB/sec |
| ----- | ------ | ------ | ------ | --------- | --------- | --------- | ------ | ------ | ----- | ---------- | ----------- | ----------- |
| 购票  | 13190  | 416    | 398    | 503       | 556       | 653       | 211    | 972    | 0.00% | 1139.5/sec | 310.62      | 874.67      |
| 查票  | 39,081 | 166    | 158    | 204       | 225       | 265       | 27     | 352    | 0.00% | 1752.9/sec | 1140.10     | 837.08      |

![image-20250930204507779](..\resource\Images\压测3.png)

![image-20250930191624751](..\resource\Images\压测4.png)

#### 3，v2重构后

使用mp重构业务代码：

| Label | #样本  | 平均值 | 中位数 | 90%百分位 | 95%百分位 | 99%百分位 | 最小值 | 最大值 | 异常% | 吞吐量     | 接收KB/sec | 发送KB/sec |
| ----- | ------ | ------ | ------ | --------- | --------- | --------- | ------ | ------ | ----- | ---------- | ---------- | ---------- |
| 购票  | 31,193 | 427    | 417    | 529       | 560       | 679       | 203    | 1,155  | 0.00% | 1143.9/sec | 312.30     | 878.00     |
| 查票  | 74411  | 165    | 153    | 215       | 244       | 316       | 89     | 419    | 0.00% | 1801.8/sec | 1173.80    | 860.41     |

![image-20250930223154339](..\resource\Images\压测5.png)

![image-20250930192701767](..\resource\Images\压测6.png)

#### 4，v3优化后

1，增加 Redis 预扣减库存后，吞吐量大概在1300+/sec，提升约17.5%，请求响应速度提升巨大。

2，增加MQ异步为用户添加车票后，吞吐量提升不大，请求响应速度提升较大。

3，增加乐观锁，吞吐量变化不大，但是超卖保证进一步加强。

| Label     | #样本  | 平均值 | 中位数 | 90%百分位 | 95%百分位 | 99%百分位 | 最小值 | 最大值 | 异常% | 吞吐量     | 接收 KB/sec | 发送 KB/sec |
| :-------- | :----- | :----- | :----- | :-------- | :-------- | :-------- | :----- | :----- | :---- | :--------- | :---------- | :---------- |
| **1购票** | 14,065 | 70     | 66     | 93        | 114       | 160       | 7      | 351    | 0.00% | 1344.1/sec | 366.93      | 1031.73     |
| **2购票** | 36,292 | 35     | 32     | 48        | 58        | 80        | 6      | 552    | 0.00% | 1368.6/sec | 373.73      | 1050.53     |
| **3购票** | 29,635 | 36     | 33     | 51        | 60        | 81        | 6      | 248    | 0.00% | 1338.9/sec | 365.64      | 1027.74     |

