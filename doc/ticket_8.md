### 高并发和性能优化

### 如何保证不超卖/数据一致性

防超卖是数据一致性在库存场景的具体应用。

v1：redis分布式锁串行操作，MQ 排队削峰异步，RocketMQ框架自带消费端重试机制和死信队列

v3：细化redis锁锁粒度，添加 Redis 预扣减，数据库层添加乐观锁，添加异常回退Redis和MySQL

更多优化思路：Redis 集群 + 持久化，分库分表，增加定时任务补偿兜底，引入 状态机 或 Saga 模式 处理长事务

### 如何应对秒杀

v1：前端验证码限流，秒杀令牌限流，Sentinel熔断降级，MQ 排队削峰异步

v3：改为标准令牌桶，细化redis锁锁粒度，添加 Redis 预扣减，MQ异步添加乘客车票，Redis防护缓存穿透、击穿、雪崩

更多优化思路：分库分表、Redis 集群

### 如何保证消息不丢失

v1：RocketMQ 默认持久化、自动ACK、消费端重试机制、死信队列、保证消息的先入先出顺序

v3：幂等发送和消费，添加发送确认机制

更多优化思路：事务消息，监控补偿机制
