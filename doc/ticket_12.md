### 总结

>个人对于项目的反思和开发过程的总结，仅供参考

#### 项目背景和整体架构

为什么选择做这个项目？难点和价值在哪里？

- 我想做一个分布式高并发项目，本来想做电商秒杀，但是还是选择了车票，因为动态库存，对一致性和不超卖的要求更高(秒杀极少的超卖可以容忍)，更复杂的业务逻辑和状态管理，读大于写。而且电商已经很成熟，模板化。
- 难点在于更复杂的业务逻辑(动态复用库存，多票选座等)，数据一致性要求高(防超卖，防重复座位)，可靠性要求高（防止消息丢失），应对高并发（放票时的请求洪流），系统高可用（保障系统稳定）等。
- 价值在生产上至少看不出来，代码很多问题，并不专业，在学习上的价值也不敢自大，至少我在这个过程学习了很多技术，学习很多组件中间件的集成和使用，发现和解决了许多问题等。

系统架构是怎样的？

系统能支持多大QPS？做了哪些优化？

系统模块有哪些？每个模块的职责是什么？

数据库和缓存选型理由是什么？

为什么选择微服务？服务拆分原则是什么？

#### 核心功能实现

支付和退票如何处理？

+ 我没写

余票数据如何存储和查询？为什么？

- admin设置车次车厢座位余票，跑批生成日期数据的时候存入redis，redis预扣减，为什么？最佳实践，快，一致性
- 查询直接查redis，使用缓存空值 + 布隆过滤器防穿透，使用互斥锁防击穿，过期时间随机化防雪崩

Redis缓存和数据库如何保证一致性？

- redis回滚和Seata事务

订单状态如何管理？

- ConfirmOrderStatusEnum有六种状态，请求经过校验和令牌桶生成，消费消息的时候变成处理中，购票时候变成成功or失败or无票or取消

边界情况如何处理？例如库存为0时、用户超时未支付等。

- 统一异常和自定义异常校验，返回给前端，在BusinessExceptionEnum

如何保证不会超卖？

#### 高并发和性能优化

消息队列用在哪些场景？如何保证消息不丢失？

- 异步排队购票和购票完成后的跨模块添加车票

系统性能瓶颈可能出在哪里？如何优化？

- Redis，MySQL乐观锁冲突导致的频繁回滚和重试，硬件
- Redis集群，MySQL读写分离，硬件升级或横向堆积

数据库锁竞争如何解决？

- 抛出异常，Redis回滚和Seata事务

多线程处理在哪些场景用到？

- RocketMQ 的消费者客户端本身是多线程模型，Tomcat框架实现的并发处理

Redis分布式细粒度锁的设计？

- 车次 + 日期 + 座位类型。

Redis+Lua脚本在库存预扣减中的具体作用是什么？Lua脚本为什么能保证原子性？

- processOrder方法，Lua脚本原子化扣减库存，不成功返回库存不足

数据库层乐观锁是如何实现的？与Redis预扣减如何协同保证数据最终一致性？

- mp内置的乐观锁插件。数据库添加version字段，实体类添加字段和@version注解，添加配置类即可。
- 乐观锁，不锁表行，性能高，适合高并发，代码复杂度略高，适合高并发抢票场景，库存数量较大，冲突概率可接受。Redis 已经起到“预扣减库存”的作用，这里作为一个“兜底”的作用。如果发送乐观锁冲突Redis也会回滚。

在扣减库存过程中发生异常时，描述你的回退机制和事务处理方案

- 处理单个订单的时候发生异常，触发processOrder的try-catch回滚和afterDoConfirm的Seata事务注解@GlobalTransactional

如何处理瞬时高并发请求（秒杀场景）？

压测结果如何体现？有哪些优化方向？

如何应对秒杀场景下库存抢光的瞬时高峰？

#### 分布式与微服务

用户登录状态如何管理？

- JWT登录

服务拆分原则是什么？

分布式事务如何保证？

- Seata AT 模式 + MQ异步

服务间通信是同步还是异步？为什么？

- 异步，afterDoConfirm发送MQ异步为用户添加车票

服务注册与发现用哪种组件？有什么作用？

配置中心如何管理微服务配置？

服务降级和熔断如何设计？

#### 异常与边界场景

如何处理重复提交订单？

用户抢票失败或支付失败如何处理？

网络延迟或中断时，如何保证数据一致性？

如何处理库存为0的情况？

异常日志和监控如何设计？

#### 安全与防护

如何防刷票或机器人？

数据安全和接口安全怎么保证？

用户权限和操作权限如何控制？

系统如何防止恶意并发请求？

#### 系统扩展性与优化

项目有哪些可优化的地方？

遇到的最大挑战是什么？怎么解决的？

如果未来业务量再增长，系统如何扩展？

你最自豪的技术亮点是什么？

